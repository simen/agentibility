<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Validation Demo</title>
  <style>
    .error { color: red; font-size: 0.875rem; }
    .field-error input, .field-error select, .field-error textarea {
      border: 2px solid red;
    }
    .success { color: green; }
    .form-group { margin-bottom: 1rem; }
    [aria-invalid="true"] { border-color: red; }
  </style>
</head>
<body>
  <header role="banner">
    <h1>Registration Form</h1>
  </header>

  <main role="main">
    <form id="registration-form" aria-label="User registration" novalidate>
      <div class="form-group">
        <label for="username">Username <span aria-hidden="true">*</span></label>
        <input type="text" id="username" name="username" required
               aria-required="true" aria-describedby="username-help username-error"
               minlength="3" maxlength="20" pattern="^[a-zA-Z0-9_]+$">
        <small id="username-help">3-20 characters, letters, numbers, underscore only</small>
        <div id="username-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="email">Email <span aria-hidden="true">*</span></label>
        <input type="email" id="email" name="email" required
               aria-required="true" aria-describedby="email-error">
        <div id="email-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="password">Password <span aria-hidden="true">*</span></label>
        <input type="password" id="password" name="password" required
               aria-required="true" aria-describedby="password-help password-error"
               minlength="8">
        <small id="password-help">Minimum 8 characters, must include uppercase, lowercase, and number</small>
        <div id="password-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="confirm-password">Confirm Password <span aria-hidden="true">*</span></label>
        <input type="password" id="confirm-password" name="confirm_password" required
               aria-required="true" aria-describedby="confirm-error">
        <div id="confirm-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="age">Age</label>
        <input type="number" id="age" name="age" min="13" max="120"
               aria-describedby="age-error">
        <div id="age-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="country">Country <span aria-hidden="true">*</span></label>
        <select id="country" name="country" required aria-required="true"
                aria-describedby="country-error">
          <option value="">-- Select Country --</option>
          <option value="us">United States</option>
          <option value="uk">United Kingdom</option>
          <option value="ca">Canada</option>
          <option value="au">Australia</option>
          <option value="de">Germany</option>
        </select>
        <div id="country-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <div class="form-group">
        <label for="bio">Bio</label>
        <textarea id="bio" name="bio" rows="3" maxlength="500"
                  aria-describedby="bio-help bio-error"></textarea>
        <small id="bio-help">Optional, max 500 characters. <span id="bio-count">0/500</span></small>
        <div id="bio-error" class="error" role="alert" aria-live="polite"></div>
      </div>

      <fieldset>
        <legend>Terms and Conditions</legend>
        <div class="form-group">
          <input type="checkbox" id="terms" name="terms" required aria-required="true">
          <label for="terms">I accept the <a href="#terms-modal">terms and conditions</a> <span aria-hidden="true">*</span></label>
          <div id="terms-error" class="error" role="alert" aria-live="polite"></div>
        </div>
        <div class="form-group">
          <input type="checkbox" id="newsletter" name="newsletter">
          <label for="newsletter">Subscribe to newsletter (optional)</label>
        </div>
      </fieldset>

      <div id="form-summary" aria-live="polite" role="status"></div>

      <button type="submit" id="submit-btn">Create Account</button>
      <button type="reset" id="reset-btn">Reset Form</button>
    </form>

    <section id="success-message" aria-label="Registration success" style="display: none;">
      <h2>Registration Successful!</h2>
      <p id="welcome-message"></p>
    </section>
  </main>

  <footer role="contentinfo">
    <p>&copy; 2024 Form Validation Demo</p>
  </footer>

  <script>
    const form = document.getElementById('registration-form');
    const fields = {
      username: document.getElementById('username'),
      email: document.getElementById('email'),
      password: document.getElementById('password'),
      confirmPassword: document.getElementById('confirm-password'),
      age: document.getElementById('age'),
      country: document.getElementById('country'),
      bio: document.getElementById('bio'),
      terms: document.getElementById('terms')
    };

    const errors = {
      username: document.getElementById('username-error'),
      email: document.getElementById('email-error'),
      password: document.getElementById('password-error'),
      confirmPassword: document.getElementById('confirm-error'),
      age: document.getElementById('age-error'),
      country: document.getElementById('country-error'),
      bio: document.getElementById('bio-error'),
      terms: document.getElementById('terms-error')
    };

    function setError(field, message) {
      errors[field].textContent = message;
      fields[field].setAttribute('aria-invalid', 'true');
      fields[field].parentElement.classList.add('field-error');
    }

    function clearError(field) {
      errors[field].textContent = '';
      fields[field].removeAttribute('aria-invalid');
      fields[field].parentElement.classList.remove('field-error');
    }

    function validateUsername() {
      const value = fields.username.value.trim();
      if (!value) {
        setError('username', 'Username is required');
        return false;
      }
      if (value.length < 3) {
        setError('username', 'Username must be at least 3 characters');
        return false;
      }
      if (value.length > 20) {
        setError('username', 'Username must be 20 characters or less');
        return false;
      }
      if (!/^[a-zA-Z0-9_]+$/.test(value)) {
        setError('username', 'Username can only contain letters, numbers, and underscores');
        return false;
      }
      if (value === 'admin' || value === 'root') {
        setError('username', 'This username is not available');
        return false;
      }
      clearError('username');
      return true;
    }

    function validateEmail() {
      const value = fields.email.value.trim();
      if (!value) {
        setError('email', 'Email is required');
        return false;
      }
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
        setError('email', 'Please enter a valid email address');
        return false;
      }
      clearError('email');
      return true;
    }

    function validatePassword() {
      const value = fields.password.value;
      if (!value) {
        setError('password', 'Password is required');
        return false;
      }
      if (value.length < 8) {
        setError('password', 'Password must be at least 8 characters');
        return false;
      }
      if (!/[A-Z]/.test(value)) {
        setError('password', 'Password must contain at least one uppercase letter');
        return false;
      }
      if (!/[a-z]/.test(value)) {
        setError('password', 'Password must contain at least one lowercase letter');
        return false;
      }
      if (!/[0-9]/.test(value)) {
        setError('password', 'Password must contain at least one number');
        return false;
      }
      clearError('password');
      return true;
    }

    function validateConfirmPassword() {
      const value = fields.confirmPassword.value;
      if (!value) {
        setError('confirmPassword', 'Please confirm your password');
        return false;
      }
      if (value !== fields.password.value) {
        setError('confirmPassword', 'Passwords do not match');
        return false;
      }
      clearError('confirmPassword');
      return true;
    }

    function validateAge() {
      const value = fields.age.value;
      if (value) {
        const age = parseInt(value, 10);
        if (isNaN(age) || age < 13) {
          setError('age', 'You must be at least 13 years old');
          return false;
        }
        if (age > 120) {
          setError('age', 'Please enter a valid age');
          return false;
        }
      }
      clearError('age');
      return true;
    }

    function validateCountry() {
      if (!fields.country.value) {
        setError('country', 'Please select a country');
        return false;
      }
      clearError('country');
      return true;
    }

    function validateTerms() {
      if (!fields.terms.checked) {
        setError('terms', 'You must accept the terms and conditions');
        return false;
      }
      clearError('terms');
      return true;
    }

    // Real-time validation on blur
    fields.username.addEventListener('blur', validateUsername);
    fields.email.addEventListener('blur', validateEmail);
    fields.password.addEventListener('blur', validatePassword);
    fields.confirmPassword.addEventListener('blur', validateConfirmPassword);
    fields.age.addEventListener('blur', validateAge);
    fields.country.addEventListener('blur', validateCountry);
    fields.terms.addEventListener('change', validateTerms);

    // Bio character count
    fields.bio.addEventListener('input', () => {
      document.getElementById('bio-count').textContent =
        fields.bio.value.length + '/500';
    });

    // Form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const validations = [
        validateUsername(),
        validateEmail(),
        validatePassword(),
        validateConfirmPassword(),
        validateAge(),
        validateCountry(),
        validateTerms()
      ];

      const isValid = validations.every(v => v);

      if (isValid) {
        form.style.display = 'none';
        const successSection = document.getElementById('success-message');
        successSection.style.display = 'block';
        document.getElementById('welcome-message').textContent =
          'Welcome, ' + fields.username.value + '! Your account has been created.';
      } else {
        const errorCount = validations.filter(v => !v).length;
        document.getElementById('form-summary').innerHTML =
          '<p class="error">Please fix ' + errorCount + ' error(s) before submitting.</p>';
        // Focus first invalid field
        const firstInvalid = form.querySelector('[aria-invalid="true"]');
        if (firstInvalid) firstInvalid.focus();
      }
    });

    // Reset form
    form.addEventListener('reset', () => {
      Object.keys(errors).forEach(key => clearError(key));
      document.getElementById('form-summary').innerHTML = '';
      document.getElementById('bio-count').textContent = '0/500';
    });
  </script>
</body>
</html>
